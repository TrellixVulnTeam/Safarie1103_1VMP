---
title: "Assignment 8.1 -  ThoracicSurgeryData"
author: "edris safari"
date: "2/1/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Assignment 8.1 -  ThoracicSurgeryData

a. Fit a binary logistic regression model to the data set that predicts whether or not the patient survived for one year (the Risk1Y variable) after the surgery. Use the glm() function to perform the logistic regression. See Generalized Linear Models for an example. Include a summary using the summary() function in your results.

b. According to the summary, which variables had the greatest effect on the survival rate?

c. To compute the accuracy of your model, use the dataset to predict the outcome variable. The percent of correct predictions is the accuracy of your model. What is the accuracy of your model?



 ```{r ,echo=FALSE,message=FALSE,warning=FALSE}
library(ggplot2)
library(stats)
library(GGally)
library(scatterplot3d)
library(lm.beta)
library("readxl")
library(foreign)
library(caTools)
```
### Import dataset

```{r import dataset,echo=FALSE,message=FALSE,warning=FALSE}
getwd()
setwd(".\\")
getwd()
ThoracicSurgeryData <-read.arff("ThoraricSurgery.arff")
#str(ThoracicSurgeryData)
#head(ThoracicSurgeryData)
#names(ThoracicSurgeryData)
```



```{r Create training and test sets,echo=FALSE,message=FALSE,warning=FALSE}
# Splitting the dataset into the Training set and Test set

set.seed(123)
split = sample.split(ThoracicSurgeryData$Risk1Yr, SplitRatio = 0.80)
training_set = subset(ThoracicSurgeryData, split == TRUE)
test_set = subset(ThoracicSurgeryData, split == FALSE)
```

## Classifier with one independent variable-AGE

```{r create classifier1,echo=FALSE,message=FALSE,warning=FALSE}
ThoracicSurgeryData_Model_1 <-  glm(Risk1Yr ~ AGE, data = training_set, family = binomial())
summary(ThoracicSurgeryData_Model_1)
```

```{r modelchi1 ,echo=FALSE,message=FALSE,warning=FALSE}
modelChi <- ThoracicSurgeryData_Model_1$null.deviance - ThoracicSurgeryData_Model_1$deviance
modelChi
```

The low modelchi value of $`r modelChi`$ indicates that significance of AGE is minimal. In effect, null deviance and residual null deviance are almost equal. AGE's P value is also higher than.05 at $.9898$

```{r chdf1 ,echo=FALSE,message=FALSE,warning=FALSE}
chidf <- ThoracicSurgeryData_Model_1$df.null - ThoracicSurgeryData_Model_1$df.residual
chidf
```

Degree of freedome at $`r chidf`$ shows that there is only one indepedent variable in the model.

```{r chsq.prob1 ,echo=FALSE,message=FALSE,warning=FALSE}
chisq.prob <- 1 - pchisq(modelChi,chidf)
chisq.prob
```

The chi-squared probability at $`r chisq.prob`$  shows a p-value higher than $0.05$ which indicates that we can accept the null hypothesis.

```{r confint1 ,echo=FALSE,message=FALSE,warning=FALSE}
exp(confint(ThoracicSurgeryData_Model_1))
```
## Predict using test set
```{r Predict1 ,echo=FALSE,message=FALSE,warning=FALSE}
prob_pred = predict(glm_ThoracicSurgeryData_1, type = 'response', newdata = test_set[-17])
y_pred = ifelse(prob_pred > 0.5, 1, 0)
y_pred
# Making the Confusion Matrix
cm = table(test_set[, 17], y_pred > 0.5)
cm
```

With 80 

## Create a classifier with two independent variables-AGE and PRE30(Smoking)


```{r create classifier_2,echo=FALSE,message=FALSE,warning=FALSE}
ThoracicSurgeryData_Model_2 <-  glm(Risk1Yr ~ AGE + PRE30, data = training_set, family = binomial())
summary(ThoracicSurgeryData_Model_2)
```
```{r ANOVA ,echo=FALSE,message=FALSE,warning=FALSE}
anova(ThoracicSurgeryData_Model_1,ThoracicSurgeryData_Model_2)
```
An increase in Deviance shows the improvement of the model after adding the independent variable PRE30(Smoking)

```{r modelchi_2 ,echo=FALSE,message=FALSE,warning=FALSE}
modelChi <- ThoracicSurgeryData_Model_2$null.deviance - ThoracicSurgeryData_Model_2$deviance
modelChi
```
An increase in model chil value shows that PRE30(Smoking) does have significance in the model.

```{r chdf_2 ,echo=FALSE,message=FALSE,warning=FALSE}
chidf <- ThoracicSurgeryData_Model_2$df.null - ThoracicSurgeryData_Model_2$df.residual
chidf
```
Degree of freedome at $`r chidf`$ shows that there are two indepedent variables in the model.
```{r chsq.prob_2 ,echo=FALSE,message=FALSE,warning=FALSE}
chisq.prob <- 1 - pchisq(modelChi,chidf)
chisq.prob
```
The chi-squared probability at $`r chisq.prob`$  shows a p-value higher than $0.05$ which indicates that we can accept the null hypothesis.